Claro, vamos começar a criar um namespace do Event Hubs, um Event Hub dentro dele, enviar uma mensagem e, em seguida, consumi-la. Aqui estão os passos que você pode seguir usando o Azure CLI no Cloud Shell:

Login no Azure CLI: Se você ainda não fez login, faça-o com o comando:

az login
Siga as instruções na tela para concluir o login.

Crie um grupo de recursos: Vamos criar um grupo de recursos chamado "testcasa" na região "us-east".

az group create --name testcasa --location eastus
Crie um namespace do Event Hubs: Vamos criar um namespace chamado "testcasanamespace" no grupo de recursos "testcasa". Este comando criará um namespace Standard.

az eventhubs namespace create --name testcasanamespace --resource-group testcasa --sku Standard
Crie um Event Hub: Vamos criar um Event Hub chamado "testcasaeventhub" no namespace "testcasanamespace".

az eventhubs eventhub create --name testcasaeventhub --namespace-name testcasanamespace --resource-group testcasa
Envie uma mensagem para o Event Hub: Primeiro, precisamos instalar a biblioteca do Azure Event Hubs para Python. Você pode fazer isso com o seguinte comando:

pip install azure-eventhub
Em seguida, você pode usar o seguinte script Python para enviar uma mensagem para o Event Hub:

python
Copy code
from azure.eventhub import EventHubProducerClient, EventData

# Obtenha a string de conexão do namespace. Substitua com suas próprias informações.
connection_str = 'Endpoint=sb://testcasanamespace.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=<YourPrimaryKey>;EntityPath=testcasaeventhub'

producer = EventHubProducerClient.from_connection_string(conn_str=connection_str)

# Envie uma única mensagem
event_data = EventData("Hello, Azure Event Hubs!")
with producer:
    producer.send(event_data)
Verifique a mensagem no painel do Azure: Você pode visualizar a mensagem no painel do Azure. Navegue até o seu Event Hub (testcasaeventhub), e você deve ser capaz de ver os detalhes da mensagem.

Consuma a mensagem do Event Hub: Você pode usar o seguinte script Python para consumir a mensagem do Event Hub:

python
Copy code
from azure.eventhub import EventHubConsumerClient

# Substitua com suas próprias informações
connection_str = 'Endpoint=sb://testcasanamespace.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=<YourPrimaryKey>;EntityPath=testcasaeventhub'
consumer_group = '$Default'

client = EventHubConsumerClient.from_connection_string(connection_str, consumer_group)

def on_event(partition_context, event):
    # Imprima a mensagem recebida
    print("Received event from partition: {}.".format(partition_context.partition_id))
    print("Message: ", event.body_as_str())

    # Marque a mensagem como consumida
    partition_context.update_checkpoint(event)

with client:
    client.receive(on_event=on_event)
